<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      8问Redis | 逝水流LF 
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="Dillon Liang">
    
    

    <meta name="description" content="Redis在项目开发中起着举足轻重的作用，也是互联网公司面试必考的点，下面的灵魂8问，不知道你能答得上来几个？">
<meta name="keywords" content="redis">
<meta property="og:type" content="article">
<meta property="og:title" content="8问Redis | 逝水流LF">
<meta property="og:url" content="http://yoursite.com/2019/09/16/8问redis/index.html">
<meta property="og:site_name" content="逝水流LF">
<meta property="og:description" content="Redis在项目开发中起着举足轻重的作用，也是互联网公司面试必考的点，下面的灵魂8问，不知道你能答得上来几个？">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2021-02-22T07:24:17.338Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="8问Redis | 逝水流LF">
<meta name="twitter:description" content="Redis在项目开发中起着举足轻重的作用，也是互联网公司面试必考的点，下面的灵魂8问，不知道你能答得上来几个？">
    
    
    
      <link rel="icon" type="image/x-icon" href="/favicon.png">
    
    <link rel="stylesheet" href="/css/uno.css">
    <link rel="stylesheet" href="/css/highlight.css">
    <link rel="stylesheet" href="/css/archive.css">
    <link rel="stylesheet" href="/css/china-social-icon.css">

</head>
<body>

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    

<header class="panel-cover panel-cover--collapsed">


  <div class="panel-main">

  
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">逝水流LF</a></h1>
        <hr class="panel-cover__divider">

        

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">

              
                
                <li class="navigation__item"><a href="/#blog" title class="blog-button">首页</a></li>
              
                
                <li class="navigation__item"><a href="/about" title class>关于</a></li>
              
                
                <li class="navigation__item"><a href="/archive" title class>归档</a></li>
              

            </ul>
          </nav>

          <!-- ----------------------------
To add a new social icon simply duplicate one of the list items from below
and change the class in the <i> tag to match the desired social network
and then add your link to the <a>. Here is a full list of social network
classes that you can use:

    icon-social-500px
    icon-social-behance
    icon-social-delicious
    icon-social-designer-news
    icon-social-deviant-art
    icon-social-digg
    icon-social-dribbble
    icon-social-facebook
    icon-social-flickr
    icon-social-forrst
    icon-social-foursquare
    icon-social-github
    icon-social-google-plus
    icon-social-hi5
    icon-social-instagram
    icon-social-lastfm
    icon-social-linkedin
    icon-social-medium
    icon-social-myspace
    icon-social-path
    icon-social-pinterest
    icon-social-rdio
    icon-social-reddit
    icon-social-skype
    icon-social-spotify
    icon-social-stack-overflow
    icon-social-steam
    icon-social-stumbleupon
    icon-social-treehouse
    icon-social-tumblr
    icon-social-twitter
    icon-social-vimeo
    icon-social-xbox
    icon-social-yelp
    icon-social-youtube
    icon-social-zerply
    icon-mail

-------------------------------->

<!-- add social info here -->



        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner entry">
            

<article class="post-container post-container--single">

  <header class="post-header">
    
    <h1 class="post-title">8问Redis</h1>

    

    <div class="post-meta">
      <time datetime="2019-09-16" class="post-meta__date date">2019-09-16</time> 

      <span class="post-meta__tags tags">

          

          
             &#8226; 标签:
            <font class="tags">
              <a class="tags-link" href="/tags/redis/">redis</a>
            </font>
          

      </span>
    </div>
    
    

  </header>

  <section id="post-content" class="article-content post">
    <p>Redis在项目开发中起着举足轻重的作用，也是互联网公司面试必考的点，下面的灵魂8问，不知道你能答得上来几个？</p>
<a id="more"></a>
<h2 id="基础功能"><a href="#基础功能" class="headerlink" title="基础功能"></a>基础功能</h2><ol>
<li>为什么使用Redis?</li>
<li>使用Redis有什么缺点？</li>
<li>单线程的Redis为什么这么快？</li>
<li>Redis的数据类型及使用场景</li>
<li>Redis过期策略和内存淘汰机制？</li>
<li>Redis和数据库双写一致性问题</li>
<li>如何应对缓存穿透和缓存雪崩问题</li>
<li>如果解决Redis并发竞争key问题？</li>
</ol>
<h3 id="为什么使用Redis"><a href="#为什么使用Redis" class="headerlink" title="为什么使用Redis?"></a>为什么使用Redis?</h3><p>项目中使用Redis，主要考虑性能和并发。</p>
<p>在高并发的情况下，如果所有请求直接打到数据库，数据库连接数会很快用完，出现连接异常。</p>
<p>如果用Redis，可以做一层缓存，请求先访问Redis缓存，缓冲命中的情况下，直接返回了，不需要请求数据库，缓冲未命中才会请求数据库，并把请求结果缓存到Redis，提高了程序的性能和并发。</p>
<h3 id="使用Redis有什么缺点？"><a href="#使用Redis有什么缺点？" class="headerlink" title="使用Redis有什么缺点？"></a>使用Redis有什么缺点？</h3><p>使用Redis可以解决高并发问题，但也会引入新的问题。</p>
<ul>
<li>缓存和数据库双写一致性问题</li>
<li>缓存雪崩问题</li>
<li>缓存击穿问题</li>
<li>缓存的并发竞争问题</li>
</ul>
<h3 id="单线程的Redis为什么这么快？"><a href="#单线程的Redis为什么这么快？" class="headerlink" title="单线程的Redis为什么这么快？"></a>单线程的Redis为什么这么快？</h3><p>单线程工作模型，基于内存</p>
<ul>
<li>纯内存操作</li>
<li>核心是基于非阻塞的IO多路复用机制</li>
<li>C语言实现</li>
<li>单线程，避免了多线程的频繁上下文切换问题，预防了多线程可能产生的竞争问题。</li>
</ul>
<h3 id="Redis的数据类型及使用场景"><a href="#Redis的数据类型及使用场景" class="headerlink" title="Redis的数据类型及使用场景"></a>Redis的数据类型及使用场景</h3><p><strong>String</strong>: 存储计数或字符串<br><strong>Hash</strong>: 结构体信息<br><strong>List</strong>: 消息队列<br><strong>Set</strong>: 去重<br><strong>SortedSet</strong>: 排行榜应用</p>
<h3 id="Redis过期策略和内存淘汰机制？"><a href="#Redis过期策略和内存淘汰机制？" class="headerlink" title="Redis过期策略和内存淘汰机制？"></a>Redis过期策略和内存淘汰机制？</h3><p>Redis采用的是定期删除+惰性删除策略。</p>
<h3 id="Redis和数据库双写一致性问题"><a href="#Redis和数据库双写一致性问题" class="headerlink" title="Redis和数据库双写一致性问题"></a>Redis和数据库双写一致性问题</h3><p>最终一致性和强一致性</p>
<p><strong>redis无法和数据库做到强一致性</strong></p>
<p>最终一致性：</p>
<ol>
<li>先删缓存，再更新数据库（客户端可能读到的是旧的数据，因为删完缓存后，还没有写入数据库，但是有新的请求读到了旧的数据，导致缓存里也是旧的数据）</li>
<li>先更新数据库，再删缓存（更新数据库后，有请求读到了缓存里的旧数据，导致数据不一致，删除缓存后，再读到的数据就是一致的了）</li>
<li>先删缓存，再更新数据库，再删缓存（同第一步，所以二次删缓存，保证最终一致性）</li>
</ol>
<h3 id="如何应对缓存穿透和缓存雪崩问题"><a href="#如何应对缓存穿透和缓存雪崩问题" class="headerlink" title="如何应对缓存穿透和缓存雪崩问题"></a>如何应对缓存穿透和缓存雪崩问题</h3><h4 id="缓存雪崩"><a href="#缓存雪崩" class="headerlink" title="缓存雪崩"></a>缓存雪崩</h4><p>redis服务器意外宕机，导致redis不可用，所有请求打到数据库，数据库连接数上升达到上限，会出现数据库连接异常，影响业务，即使redis恢复，可能redis里没有数据，还是瞬间打满数据库连接，引起缓存雪崩问题。</p>
<p>解决方案：</p>
<ol>
<li>事前：Redis建立高可用方案，主从复制+哨兵+集群，保证不会全部出现宕机</li>
<li>事中：开启限流/降级机制，保证最大连接数不超过数据库承受的连接数</li>
<li>事后： 开启Redis缓存，保证redis重启后，redis恢复缓存数据</li>
</ol>
<h4 id="缓存穿透"><a href="#缓存穿透" class="headerlink" title="缓存穿透"></a>缓存穿透</h4><p>黑客通过模拟大量不存在的key请求系统，因为在缓存里找不到数据，就会去数据库里查询，也会导致连接数上升，浪费资源</p>
<p>解决方案：</p>
<ol>
<li>校验key的合法性（如果用了mongodb的_id，可以校验mongodb的合法性）</li>
<li>对于不存在的key，即是在数据库里没有查到数据，可以写一个默认值到缓存里并设立TTL，业务上别忘了处理这种情况</li>
<li>布隆过滤器，优先过滤是否存在key</li>
</ol>
<h4 id="缓存击穿"><a href="#缓存击穿" class="headerlink" title="缓存击穿"></a>缓存击穿</h4><p>高并发中，缓存的key正好失效，导致大量的请求打到数据库</p>
<p>解决方案：</p>
<ol>
<li>分布式锁，拿数据的时候锁住，会影响性能</li>
<li>后台线程在缓存失效前刷新缓存</li>
<li>如果key数据永不改变，那么把key设置为永不过期</li>
</ol>
<h4 id="热点数据集中失效问题"><a href="#热点数据集中失效问题" class="headerlink" title="热点数据集中失效问题"></a>热点数据集中失效问题</h4><p>解决方案：</p>
<ol>
<li>设置key的过期时间时，在基础时间上加一个指定范围的随机数</li>
</ol>
<h3 id="如果解决Redis并发竞争key问题？"><a href="#如果解决Redis并发竞争key问题？" class="headerlink" title="如果解决Redis并发竞争key问题？"></a>如果解决Redis并发竞争key问题？</h3><p>参考： <a href="https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/redis-cas.md" target="_blank" rel="noopener">https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/redis-cas.md</a></p>
<ol>
<li>分布式锁，同一时间，只能由一个人来写入，其他人都不允许读和写</li>
</ol>
<h2 id="高级功能"><a href="#高级功能" class="headerlink" title="高级功能"></a>高级功能</h2><h3 id="Redis的线程模型"><a href="#Redis的线程模型" class="headerlink" title="Redis的线程模型"></a>Redis的线程模型</h3><p>参考： <a href="https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/redis-single-thread-model.md" target="_blank" rel="noopener">https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/redis-single-thread-model.md</a></p>
<h3 id="Redis集群"><a href="#Redis集群" class="headerlink" title="Redis集群"></a>Redis集群</h3><p>参考：<a href="https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/redis-cluster.md" target="_blank" rel="noopener">https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/redis-cluster.md</a></p>
<h3 id="Redis过期策略"><a href="#Redis过期策略" class="headerlink" title="Redis过期策略"></a>Redis过期策略</h3><p>参考：<a href="https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/redis-expiration-policies-and-lru.md" target="_blank" rel="noopener">https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/redis-expiration-policies-and-lru.md</a></p>
<h3 id="Redis高可用-高并发"><a href="#Redis高可用-高并发" class="headerlink" title="Redis高可用/高并发"></a>Redis高可用/高并发</h3><p>参考： <a href="https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/how-to-ensure-high-concurrency-and-high-availability-of-redis.md" target="_blank" rel="noopener">https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/how-to-ensure-high-concurrency-and-high-availability-of-redis.md</a></p>

  </section>

  <section class="post-comments">

    <!-- 将评论系统（例如Disqus、多说、友言、畅言等）提供的代码片段粘贴在这里 -->
    
</section>


</article>


            <footer class="footer">

    <span class="footer__copyright">&copy; 2014-2015. | 由<a href="https://hexo.io/">Hexo</a>强力驱动 | 主题<a href="https://github.com/someus/huno">Huno</a></span>
    
</footer>
        </div>
    </div>

    <!-- js files -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/scale.fix.js"></script>
    

    

    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript"> 
        $(document).ready(function(){
            MathJax.Hub.Config({ 
                tex2jax: {inlineMath: [['[latex]','[/latex]'], ['\\(','\\)']]} 
            });
        });
    </script>


    

    <script src="/js/jquery.min.js"></script>
    <script src="/js/awesome-toc.min.js"></script>
    <script>
        $(document).ready(function(){
            $.awesome_toc({
                overlay: true,
                contentId: "post-content",
            });
        });
    </script>


    
    
    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]-->

</body>
</html>
